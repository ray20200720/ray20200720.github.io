<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="圖片檔案格式有bmp和metafile, metafile翻譯為中繼檔."><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>C# Windows Form GDI | ITHelp</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 6.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-time">2023-10-18</div></div></div><div class="container post-header"><h1>C# Windows Form GDI</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%80%E5%8F%96-bmp-%E6%AA%94"><span class="toc-number">1.</span> <span class="toc-text">讀取 bmp 檔</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%80%8BWindows-Form%E5%B0%88%E6%A1%88"><span class="toc-number">1.1.</span> <span class="toc-text">建立一個Windows Form專案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Form1-cs-%E6%B7%BB%E5%8A%A0%E4%B8%80%E5%80%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.1.</span> <span class="toc-text">在 Form1.cs 添加一個方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Form1-cs-Design-%E7%9A%84-Properties-%E7%9A%84-Events-%E6%89%BE%E5%88%B0-Paint"><span class="toc-number">1.1.2.</span> <span class="toc-text">在 Form1.cs Design 的 Properties 的 Events 找到 Paint</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A2%E7%94%9F-metafile-%E6%AA%94"><span class="toc-number">2.</span> <span class="toc-text">產生 metafile 檔</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%8A%E8%BF%B0%E7%9A%84Windows-Form%E5%B0%88%E6%A1%88"><span class="toc-number">2.1.</span> <span class="toc-text">使用上述的Windows Form專案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Form1-cs-%E5%A2%9E%E5%8A%A0%E4%B8%80%E5%80%8B%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.1.</span> <span class="toc-text">在 Form1.cs 增加一個方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Form1-cs-Design-%E4%B8%8A%E5%A2%9E%E5%8A%A0%E4%B8%80%E5%80%8B-Button-%E5%85%B6-Properties-%E5%85%A7-Events-%E6%89%BE%E5%88%B0-Click"><span class="toc-number">2.1.2.</span> <span class="toc-text">在 Form1.cs Design 上增加一個 Button, 其 Properties 內 Events 找到 Click</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E4%BE%86%E6%BA%90"><span class="toc-number">3.</span> <span class="toc-text">參考來源</span></a></li></ol></details></div><div class="container post-content"><p>圖片檔案格式有bmp和metafile, metafile翻譯為中繼檔.</p>
<p>如何使用Windows Form的GDI讀取bmp檔案,以及輸出中繼檔?</p>
<h1 id="讀取-bmp-檔"><a href="#讀取-bmp-檔" class="headerlink" title="讀取 bmp 檔"></a>讀取 bmp 檔</h1><h2 id="建立一個Windows-Form專案"><a href="#建立一個Windows-Form專案" class="headerlink" title="建立一個Windows Form專案"></a>建立一個Windows Form專案</h2><h3 id="在-Form1-cs-添加一個方法"><a href="#在-Form1-cs-添加一個方法" class="headerlink" title="在 Form1.cs 添加一個方法"></a>在 Form1.cs 添加一個方法</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Form1_Paint</span>(<span class="params"><span class="built_in">object</span> sender, PaintEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Bitmap myBitmap = <span class="keyword">new</span> Bitmap(<span class="string">@&quot;D:\Ray\MyLabs\ICON\myPic.bmp&quot;</span>);</span><br><span class="line">    e.Graphics.DrawImage(myBitmap, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在-Form1-cs-Design-的-Properties-的-Events-找到-Paint"><a href="#在-Form1-cs-Design-的-Properties-的-Events-找到-Paint" class="headerlink" title="在 Form1.cs Design 的 Properties 的 Events 找到 Paint"></a>在 Form1.cs Design 的 Properties 的 Events 找到 Paint</h3><p>將 Paint 設定為 Form1_Paint. 在 Form1.Designer.cs 內會自動生成以下程式碼</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.Paint += <span class="keyword">new</span> System.Windows.Forms.PaintEventHandler(<span class="keyword">this</span>.Form1_Paint);</span><br></pre></td></tr></table></figure>

<p>完整程式碼如下:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Required method for Designer support - do not modify</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> the contents of this method with the code editor.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitializeComponent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.SuspendLayout();</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="comment">// Form1</span></span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">this</span>.AutoScaleDimensions = <span class="keyword">new</span> System.Drawing.SizeF(<span class="number">9F</span>, <span class="number">18F</span>);</span><br><span class="line">    <span class="keyword">this</span>.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;</span><br><span class="line">    <span class="keyword">this</span>.ClientSize = <span class="keyword">new</span> System.Drawing.Size(<span class="number">800</span>, <span class="number">450</span>);</span><br><span class="line">    <span class="keyword">this</span>.Name = <span class="string">&quot;Form1&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.Text = <span class="string">&quot;Form1&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.Paint += <span class="keyword">new</span> System.Windows.Forms.PaintEventHandler(<span class="keyword">this</span>.Form1_Paint);</span><br><span class="line">    <span class="keyword">this</span>.ResumeLayout(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="產生-metafile-檔"><a href="#產生-metafile-檔" class="headerlink" title="產生 metafile 檔"></a>產生 metafile 檔</h1><h2 id="使用上述的Windows-Form專案"><a href="#使用上述的Windows-Form專案" class="headerlink" title="使用上述的Windows Form專案"></a>使用上述的Windows Form專案</h2><h3 id="在-Form1-cs-增加一個方法"><a href="#在-Form1-cs-增加一個方法" class="headerlink" title="在 Form1.cs 增加一個方法"></a>在 Form1.cs 增加一個方法</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateMetaFile_Click</span>(<span class="params"><span class="built_in">object</span> sender, System.EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Metafile curMetafile = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// Create a Graphics object</span></span><br><span class="line">    Graphics g = <span class="keyword">this</span>.CreateGraphics();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get HDC</span></span><br><span class="line">    IntPtr hdc = g.GetHdc();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a rectangle</span></span><br><span class="line">    Rectangle rect = <span class="keyword">new</span> Rectangle(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use HDC to create a metafile with a name</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        curMetafile = <span class="keyword">new</span> Metafile(<span class="string">&quot;newFile.wmf&quot;</span>, hdc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">catch</span> (Exception exp)</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(exp.Message);</span><br><span class="line">        g.ReleaseHdc(hdc);</span><br><span class="line">        g.Dispose();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a Graphics object from the Metafile object</span></span><br><span class="line">    Graphics g1 = Graphics.FromImage(curMetafile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set smooting mode</span></span><br><span class="line">    g1.SmoothingMode = SmoothingMode.HighQuality;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fill a rectangle on the Metafile object</span></span><br><span class="line">    g1.FillRectangle(Brushes.Green, rect);</span><br><span class="line">    rect.Y += <span class="number">110</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Draw an ellipse on the Metafile object</span></span><br><span class="line">    LinearGradientBrush lgBrush =</span><br><span class="line">    <span class="keyword">new</span> LinearGradientBrush(</span><br><span class="line">    rect, Color.Red, Color.Blue, <span class="number">45.0f</span>);</span><br><span class="line">    g1.FillEllipse(lgBrush, rect);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Draw text on the Metafile object</span></span><br><span class="line">    rect.Y += <span class="number">110</span>;</span><br><span class="line">    g1.DrawString(<span class="string">&quot;MetaFile Sample&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> Font(<span class="string">&quot;Verdana&quot;</span>, <span class="number">20</span>),</span><br><span class="line">    lgBrush, <span class="number">200</span>, <span class="number">200</span>,</span><br><span class="line">    StringFormat.GenericTypographic);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Release objects</span></span><br><span class="line">    g.ReleaseHdc(hdc);</span><br><span class="line">    g1.Dispose();</span><br><span class="line">    g.Dispose();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在-Form1-cs-Design-上增加一個-Button-其-Properties-內-Events-找到-Click"><a href="#在-Form1-cs-Design-上增加一個-Button-其-Properties-內-Events-找到-Click" class="headerlink" title="在 Form1.cs Design 上增加一個 Button, 其 Properties 內 Events 找到 Click"></a>在 Form1.cs Design 上增加一個 Button, 其 Properties 內 Events 找到 Click</h3><p>將 Click 設定為 CreateMetaFile_Click, 在 Form1.Designer.cs 內會自動生成以下程式碼</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.button1.Click += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.CreateMetaFile_Click);</span><br></pre></td></tr></table></figure>

<h1 id="參考來源"><a href="#參考來源" class="headerlink" title="參考來源"></a>參考來源</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.makeuseof.com/c-sharp-windows-form-graphics/">How to Add Graphics to a C# Windows Form Application</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-tw/dotnet/desktop/winforms/advanced/how-to-draw-an-existing-bitmap-to-the-screen?view=netframeworkdesktop-4.8">如何：將現有點陣圖描繪至螢幕</a></li>
<li><a target="_blank" rel="noopener" href="https://www.c-sharpcorner.com/uploadfile/mahesh/working-with-metafiles-in-gdi/">Working with Metafiles in GDI+</a></li>
</ul>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>